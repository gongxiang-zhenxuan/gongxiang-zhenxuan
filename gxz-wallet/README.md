# GXZ Wallet - å…±äº«è‡»é€‰é’±åŒ…æœåŠ¡

## æ¦‚è¿°

`gxz-wallet` æ˜¯å…±äº«è‡»é€‰å¾®æœåŠ¡æ¶æ„ä¸­çš„é’±åŒ…æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†ç”¨æˆ·é’±åŒ…ç®¡ç†ã€ä½™é¢å……å€¼ã€æ¶ˆè´¹æ‰£æ¬¾ã€è½¬è´¦äº¤æ˜“ã€ç§¯åˆ†ç®¡ç†ã€ä¼˜æƒ åˆ¸ç®¡ç†ã€èµ„é‡‘å®‰å…¨ç­‰æ ¸å¿ƒé’±åŒ…ç›¸å…³åŠŸèƒ½ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ’° é’±åŒ…ç®¡ç†
- **è´¦æˆ·åˆ›å»º**: ç”¨æˆ·é’±åŒ…è´¦æˆ·è‡ªåŠ¨åˆ›å»º
- **ä½™é¢ç®¡ç†**: å¯ç”¨ä½™é¢ã€å†»ç»“ä½™é¢ç®¡ç†
- **å¤šå¸ç§æ”¯æŒ**: æ”¯æŒäººæ°‘å¸ã€ç§¯åˆ†ã€ä¼˜æƒ åˆ¸ç­‰
- **è´¦æˆ·å®‰å…¨**: æ”¯ä»˜å¯†ç ã€å®åè®¤è¯ã€é£æ§æ£€æŸ¥

### ğŸ’³ å……å€¼æœåŠ¡
- **åœ¨çº¿å……å€¼**: æ”¯æŒæ”¯ä»˜å®ã€å¾®ä¿¡ã€é“¶è¡Œå¡å……å€¼
- **å……å€¼ä¼˜æƒ **: å……å€¼èµ é€ã€æ»¡å‡æ´»åŠ¨
- **å……å€¼è®°å½•**: å®Œæ•´çš„å……å€¼å†å²è®°å½•
- **è‡ªåŠ¨åˆ°è´¦**: å……å€¼æˆåŠŸè‡ªåŠ¨åˆ°è´¦å¤„ç†

### ğŸ›’ æ¶ˆè´¹æ‰£æ¬¾
- **è®¢å•æ”¯ä»˜**: è®¢å•æ¶ˆè´¹ä½™é¢æ‰£æ¬¾
- **é¢„æˆæƒ**: è®¢å•é¢„æ‰£æ¬¾å’Œé‡Šæ”¾
- **åˆ†æœŸæ”¯ä»˜**: æ”¯æŒåˆ†æœŸä»˜æ¬¾åŠŸèƒ½
- **é€€æ¬¾å¤„ç†**: æ¶ˆè´¹é€€æ¬¾è‡ªåŠ¨å¤„ç†

### ğŸ”„ è½¬è´¦äº¤æ˜“
- **ç”¨æˆ·è½¬è´¦**: ç”¨æˆ·é—´ä½™é¢è½¬è´¦
- **å•†æˆ·è½¬è´¦**: å‘å•†æˆ·è´¦æˆ·è½¬è´¦
- **æ‰¹é‡è½¬è´¦**: æ‰¹é‡è½¬è´¦å¤„ç†
- **è½¬è´¦é™é¢**: è½¬è´¦é‡‘é¢å’Œé¢‘æ¬¡é™åˆ¶

### ğŸ¯ ç§¯åˆ†ç³»ç»Ÿ
- **ç§¯åˆ†è·å–**: æ¶ˆè´¹è·å¾—ç§¯åˆ†å¥–åŠ±
- **ç§¯åˆ†æ¶ˆè´¹**: ç§¯åˆ†æŠµæ‰£è®¢å•é‡‘é¢
- **ç§¯åˆ†å…‘æ¢**: ç§¯åˆ†å…‘æ¢ä¼˜æƒ åˆ¸æˆ–å•†å“
- **ç§¯åˆ†è¿‡æœŸ**: ç§¯åˆ†æœ‰æ•ˆæœŸç®¡ç†

### ğŸ« ä¼˜æƒ åˆ¸ç®¡ç†
- **ä¼˜æƒ åˆ¸å‘æ”¾**: ç³»ç»Ÿè‡ªåŠ¨å‘æ”¾ä¼˜æƒ åˆ¸
- **ä¼˜æƒ åˆ¸ä½¿ç”¨**: è®¢å•ä½¿ç”¨ä¼˜æƒ åˆ¸æŠµæ‰£
- **ä¼˜æƒ åˆ¸è½¬èµ **: ç”¨æˆ·é—´ä¼˜æƒ åˆ¸è½¬èµ 
- **ä¼˜æƒ åˆ¸è¿‡æœŸ**: ä¼˜æƒ åˆ¸æœ‰æ•ˆæœŸç®¡ç†

## æŠ€æœ¯æ ˆ

- **Java**: 8
- **Spring Boot**: 2.7.x
- **Spring Cloud**: 2021.x
- **MyBatis Plus**: ORM æ¡†æ¶
- **MySQL**: ä¸»æ•°æ®åº“
- **Redis**: ç¼“å­˜å’Œåˆ†å¸ƒå¼é”
- **RocketMQ**: æ¶ˆæ¯é˜Ÿåˆ—
- **Redisson**: åˆ†å¸ƒå¼é”
- **Spring Security**: å®‰å…¨æ¡†æ¶
- **Nacos**: æœåŠ¡æ³¨å†Œå‘ç°

## æ¨¡å—ç»“æ„

```
gxz-wallet/
â”œâ”€â”€ wallet-api/                 # é’±åŒ…æœåŠ¡ API æ¨¡å—
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/gongxiang/zhenxuan/wallet/api/
â”‚   â”‚       â”œâ”€â”€ dto/            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ vo/             # è§†å›¾å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ enums/          # æšä¸¾å®šä¹‰
â”‚   â”‚       â””â”€â”€ feign/          # Feign å®¢æˆ·ç«¯æ¥å£
â”‚   â””â”€â”€ pom.xml
â”œâ”€â”€ wallet-provider/            # é’±åŒ…æœåŠ¡æä¾›è€…æ¨¡å—
â”‚   â”œâ”€â”€ src/main/java/
â”‚   â”‚   â””â”€â”€ com/gongxiang/zhenxuan/wallet/
â”‚   â”‚       â”œâ”€â”€ controller/     # æ§åˆ¶å™¨å±‚
â”‚   â”‚       â”œâ”€â”€ service/        # æœåŠ¡å±‚
â”‚   â”‚       â”œâ”€â”€ mapper/         # æ•°æ®è®¿é—®å±‚
â”‚   â”‚       â”œâ”€â”€ entity/         # å®ä½“ç±»
â”‚   â”‚       â”œâ”€â”€ config/         # é…ç½®ç±»
â”‚   â”‚       â”œâ”€â”€ security/       # å®‰å…¨ç›¸å…³
â”‚   â”‚       â”œâ”€â”€ transaction/    # äº¤æ˜“å¤„ç†
â”‚   â”‚       â”œâ”€â”€ points/         # ç§¯åˆ†ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ coupon/         # ä¼˜æƒ åˆ¸ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ risk/           # é£æ§ç³»ç»Ÿ
â”‚   â”‚       â””â”€â”€ WalletApplication.java
â”‚   â”œâ”€â”€ src/main/resources/
â”‚   â”‚   â”œâ”€â”€ application.yml     # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ mapper/            # MyBatis æ˜ å°„æ–‡ä»¶
â”‚   â””â”€â”€ pom.xml
â””â”€â”€ pom.xml
```

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### é’±åŒ…ä½™é¢ç®¡ç†
```java
// æŸ¥è¯¢é’±åŒ…ä½™é¢
WalletBalanceDTO balanceDTO = new WalletBalanceDTO();
balanceDTO.setUserId(1L);
balanceDTO.setCurrencyType(CurrencyType.CNY);
Result<WalletBalanceVO> balanceResult = walletService.getBalance(balanceDTO);

// å†»ç»“ä½™é¢
WalletFreezeDTO freezeDTO = new WalletFreezeDTO();
freezeDTO.setUserId(1L);
freezeDTO.setAmount(new BigDecimal("100.00"));
freezeDTO.setBusinessType(BusinessType.ORDER_PAYMENT);
freezeDTO.setBusinessId("ORDER_123456");
Result<Void> freezeResult = walletService.freezeBalance(freezeDTO);

// è§£å†»ä½™é¢
WalletUnfreezeDTO unfreezeDTO = new WalletUnfreezeDTO();
unfreezeDTO.setUserId(1L);
unfreezeDTO.setAmount(new BigDecimal("100.00"));
unfreezeDTO.setBusinessId("ORDER_123456");
Result<Void> unfreezeResult = walletService.unfreezeBalance(unfreezeDTO);
```

### å……å€¼æœåŠ¡
```java
// å‘èµ·å……å€¼
WalletRechargeDTO rechargeDTO = new WalletRechargeDTO();
rechargeDTO.setUserId(1L);
rechargeDTO.setAmount(new BigDecimal("100.00"));
rechargeDTO.setPaymentMethod(PaymentMethod.ALIPAY);
rechargeDTO.setClientIp("192.168.1.1");
Result<WalletRechargeVO> rechargeResult = walletService.recharge(rechargeDTO);

// å……å€¼å›è°ƒå¤„ç†
WalletRechargeCallbackDTO callbackDTO = new WalletRechargeCallbackDTO();
callbackDTO.setRechargeId(1L);
callbackDTO.setPaymentStatus(PaymentStatus.SUCCESS);
callbackDTO.setThirdPartyTradeNo("2024010112345678");
Result<Void> callbackResult = walletService.handleRechargeCallback(callbackDTO);
```

### æ¶ˆè´¹æ‰£æ¬¾
```java
// è®¢å•æ”¯ä»˜
WalletPaymentDTO paymentDTO = new WalletPaymentDTO();
paymentDTO.setUserId(1L);
paymentDTO.setOrderId(1L);
paymentDTO.setAmount(new BigDecimal("50.00"));
paymentDTO.setPaymentPassword("123456");
Result<WalletPaymentVO> paymentResult = walletService.payment(paymentDTO);

// æ”¯ä»˜é€€æ¬¾
WalletRefundDTO refundDTO = new WalletRefundDTO();
refundDTO.setUserId(1L);
refundDTO.setOrderId(1L);
refundDTO.setRefundAmount(new BigDecimal("30.00"));
refundDTO.setRefundReason("å•†å“è´¨é‡é—®é¢˜");
Result<WalletRefundVO> refundResult = walletService.refund(refundDTO);
```

### è½¬è´¦äº¤æ˜“
```java
// ç”¨æˆ·è½¬è´¦
WalletTransferDTO transferDTO = new WalletTransferDTO();
transferDTO.setFromUserId(1L);
transferDTO.setToUserId(2L);
transferDTO.setAmount(new BigDecimal("20.00"));
transferDTO.setTransferReason("æœ‹å‹ä»£ä»˜");
transferDTO.setPaymentPassword("123456");
Result<WalletTransferVO> transferResult = walletService.transfer(transferDTO);

// æŸ¥è¯¢è½¬è´¦è®°å½•
WalletTransferQueryDTO queryDTO = new WalletTransferQueryDTO();
queryDTO.setUserId(1L);
queryDTO.setStartTime(LocalDateTime.now().minusDays(30));
queryDTO.setEndTime(LocalDateTime.now());
Result<List<WalletTransferVO>> transferHistory = walletService.getTransferHistory(queryDTO);
```

### ç§¯åˆ†ç®¡ç†
```java
// è·å¾—ç§¯åˆ†
PointsEarnDTO earnDTO = new PointsEarnDTO();
earnDTO.setUserId(1L);
earnDTO.setPoints(100);
earnDTO.setEarnType(PointsEarnType.ORDER_CONSUMPTION);
earnDTO.setBusinessId("ORDER_123456");
Result<Void> earnResult = pointsService.earnPoints(earnDTO);

// æ¶ˆè´¹ç§¯åˆ†
PointsConsumeDTO consumeDTO = new PointsConsumeDTO();
consumeDTO.setUserId(1L);
consumeDTO.setPoints(50);
consumeDTO.setConsumeType(PointsConsumeType.ORDER_DEDUCTION);
consumeDTO.setBusinessId("ORDER_789012");
Result<Void> consumeResult = pointsService.consumePoints(consumeDTO);

// ç§¯åˆ†å…‘æ¢
PointsExchangeDTO exchangeDTO = new PointsExchangeDTO();
exchangeDTO.setUserId(1L);
exchangeDTO.setPoints(1000);
exchangeDTO.setExchangeType(PointsExchangeType.COUPON);
exchangeDTO.setTargetId(1L);
Result<PointsExchangeVO> exchangeResult = pointsService.exchangePoints(exchangeDTO);
```

### ä¼˜æƒ åˆ¸ç®¡ç†
```java
// å‘æ”¾ä¼˜æƒ åˆ¸
CouponIssueDTO issueDTO = new CouponIssueDTO();
issueDTO.setUserId(1L);
issueDTO.setCouponTemplateId(1L);
issueDTO.setIssueType(CouponIssueType.SYSTEM_GIFT);
Result<CouponVO> issueResult = couponService.issueCoupon(issueDTO);

// ä½¿ç”¨ä¼˜æƒ åˆ¸
CouponUseDTO useDTO = new CouponUseDTO();
useDTO.setUserId(1L);
useDTO.setCouponId(1L);
useDTO.setOrderId(1L);
useDTO.setOrderAmount(new BigDecimal("100.00"));
Result<CouponUseVO> useResult = couponService.useCoupon(useDTO);

// æŸ¥è¯¢ç”¨æˆ·ä¼˜æƒ åˆ¸
CouponQueryDTO queryDTO = new CouponQueryDTO();
queryDTO.setUserId(1L);
queryDTO.setCouponStatus(CouponStatus.AVAILABLE);
Result<List<CouponVO>> coupons = couponService.getUserCoupons(queryDTO);
```

## API æ¥å£

### é’±åŒ…ç®¡ç†æ¥å£
- `GET /api/wallet/balance/{userId}` - è·å–é’±åŒ…ä½™é¢
- `POST /api/wallet/freeze` - å†»ç»“ä½™é¢
- `POST /api/wallet/unfreeze` - è§£å†»ä½™é¢
- `GET /api/wallet/transaction/history` - è·å–äº¤æ˜“å†å²
- `POST /api/wallet/password/set` - è®¾ç½®æ”¯ä»˜å¯†ç 
- `POST /api/wallet/password/verify` - éªŒè¯æ”¯ä»˜å¯†ç 

### å……å€¼æœåŠ¡æ¥å£
- `POST /api/wallet/recharge` - å‘èµ·å……å€¼
- `POST /api/wallet/recharge/callback` - å……å€¼å›è°ƒ
- `GET /api/wallet/recharge/{id}` - è·å–å……å€¼è¯¦æƒ…
- `GET /api/wallet/recharge/history` - è·å–å……å€¼å†å²
- `POST /api/wallet/recharge/cancel` - å–æ¶ˆå……å€¼

### æ”¯ä»˜æœåŠ¡æ¥å£
- `POST /api/wallet/payment` - é’±åŒ…æ”¯ä»˜
- `POST /api/wallet/payment/verify` - éªŒè¯æ”¯ä»˜
- `POST /api/wallet/refund` - ç”³è¯·é€€æ¬¾
- `GET /api/wallet/payment/{id}` - è·å–æ”¯ä»˜è¯¦æƒ…
- `GET /api/wallet/payment/history` - è·å–æ”¯ä»˜å†å²

### è½¬è´¦æœåŠ¡æ¥å£
- `POST /api/wallet/transfer` - å‘èµ·è½¬è´¦
- `GET /api/wallet/transfer/{id}` - è·å–è½¬è´¦è¯¦æƒ…
- `GET /api/wallet/transfer/history` - è·å–è½¬è´¦å†å²
- `POST /api/wallet/transfer/cancel` - å–æ¶ˆè½¬è´¦

### ç§¯åˆ†ç®¡ç†æ¥å£
- `GET /api/points/balance/{userId}` - è·å–ç§¯åˆ†ä½™é¢
- `POST /api/points/earn` - è·å¾—ç§¯åˆ†
- `POST /api/points/consume` - æ¶ˆè´¹ç§¯åˆ†
- `POST /api/points/exchange` - ç§¯åˆ†å…‘æ¢
- `GET /api/points/history` - è·å–ç§¯åˆ†å†å²
- `GET /api/points/rules` - è·å–ç§¯åˆ†è§„åˆ™

### ä¼˜æƒ åˆ¸ç®¡ç†æ¥å£
- `POST /api/coupon/issue` - å‘æ”¾ä¼˜æƒ åˆ¸
- `POST /api/coupon/use` - ä½¿ç”¨ä¼˜æƒ åˆ¸
- `GET /api/coupon/user/{userId}` - è·å–ç”¨æˆ·ä¼˜æƒ åˆ¸
- `GET /api/coupon/{id}` - è·å–ä¼˜æƒ åˆ¸è¯¦æƒ…
- `POST /api/coupon/transfer` - è½¬èµ ä¼˜æƒ åˆ¸
- `GET /api/coupon/templates` - è·å–ä¼˜æƒ åˆ¸æ¨¡æ¿

## é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/gxz_wallet?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:123456}
    driver-class-name: com.mysql.cj.jdbc.Driver
```

### Redis é…ç½®
```yaml
spring:
  redis:
    host: ${REDIS_HOST:localhost}
    port: ${REDIS_PORT:6379}
    password: ${REDIS_PASSWORD:}
    database: 9
```

### é’±åŒ…é…ç½®
```yaml
wallet:
  balance:
    max-amount: 50000.00  # é’±åŒ…æœ€å¤§ä½™é¢
    min-recharge: 1.00    # æœ€å°å……å€¼é‡‘é¢
    max-recharge: 5000.00 # æœ€å¤§å……å€¼é‡‘é¢
  transfer:
    daily-limit: 10000.00 # æ—¥è½¬è´¦é™é¢
    single-limit: 2000.00 # å•ç¬”è½¬è´¦é™é¢
    fee-rate: 0.001       # è½¬è´¦æ‰‹ç»­è´¹æ¯”ä¾‹
  security:
    password-retry-limit: 5  # æ”¯ä»˜å¯†ç é‡è¯•æ¬¡æ•°
    lock-duration: 30        # é”å®šæ—¶é•¿(åˆ†é’Ÿ)
    require-real-name: true  # æ˜¯å¦éœ€è¦å®åè®¤è¯
  points:
    earn-rate: 0.01       # ç§¯åˆ†è·å¾—æ¯”ä¾‹
    expire-days: 365      # ç§¯åˆ†æœ‰æ•ˆæœŸ(å¤©)
    exchange-rate: 100    # ç§¯åˆ†å…‘æ¢æ¯”ä¾‹(100ç§¯åˆ†=1å…ƒ)
```

## å¯åŠ¨æ–¹å¼

### å¼€å‘ç¯å¢ƒ
```bash
# å¯åŠ¨ä¾èµ–æœåŠ¡
docker-compose up -d mysql redis rocketmq

# å¯åŠ¨é’±åŒ…æœåŠ¡
cd wallet-provider
mvn spring-boot:run
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# æ„å»ºé¡¹ç›®
mvn clean package -DskipTests

# å¯åŠ¨æœåŠ¡
java -jar wallet-provider/target/wallet-provider-1.0.0.jar
```

## ç›‘æ§ç«¯ç‚¹

- **å¥åº·æ£€æŸ¥**: `GET /actuator/health`
- **æœåŠ¡ä¿¡æ¯**: `GET /actuator/info`
- **æŒ‡æ ‡ç›‘æ§**: `GET /actuator/metrics`
- **æ—¥å¿—çº§åˆ«**: `GET /actuator/loggers`

## æ•°æ®åº“è®¾è®¡

### é’±åŒ…è´¦æˆ·è¡¨ (t_wallet_account)
```sql
CREATE TABLE t_wallet_account (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    currency_type TINYINT NOT NULL DEFAULT 1,
    available_balance DECIMAL(15,2) DEFAULT 0.00,
    frozen_balance DECIMAL(15,2) DEFAULT 0.00,
    total_balance DECIMAL(15,2) DEFAULT 0.00,
    total_recharge DECIMAL(15,2) DEFAULT 0.00,
    total_consume DECIMAL(15,2) DEFAULT 0.00,
    account_status TINYINT DEFAULT 1,
    payment_password VARCHAR(128),
    password_error_count INT DEFAULT 0,
    password_lock_time DATETIME,
    real_name_status TINYINT DEFAULT 0,
    version INT DEFAULT 0,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_currency (user_id, currency_type)
);
```

### é’±åŒ…äº¤æ˜“è®°å½•è¡¨ (t_wallet_transaction)
```sql
CREATE TABLE t_wallet_transaction (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    transaction_no VARCHAR(32) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL,
    currency_type TINYINT NOT NULL,
    transaction_type TINYINT NOT NULL,
    amount DECIMAL(12,2) NOT NULL,
    balance_before DECIMAL(15,2) NOT NULL,
    balance_after DECIMAL(15,2) NOT NULL,
    business_type TINYINT NOT NULL,
    business_id VARCHAR(64),
    business_no VARCHAR(64),
    transaction_status TINYINT DEFAULT 1,
    remark VARCHAR(500),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_business (business_type, business_id),
    INDEX idx_create_time (create_time)
);
```

### å……å€¼è®°å½•è¡¨ (t_wallet_recharge)
```sql
CREATE TABLE t_wallet_recharge (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    recharge_no VARCHAR(32) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL,
    amount DECIMAL(12,2) NOT NULL,
    actual_amount DECIMAL(12,2),
    bonus_amount DECIMAL(12,2) DEFAULT 0.00,
    payment_method TINYINT NOT NULL,
    payment_channel VARCHAR(50),
    third_party_trade_no VARCHAR(100),
    recharge_status TINYINT DEFAULT 0,
    callback_time DATETIME,
    client_ip VARCHAR(50),
    remark VARCHAR(500),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_status (recharge_status),
    INDEX idx_create_time (create_time)
);
```

### è½¬è´¦è®°å½•è¡¨ (t_wallet_transfer)
```sql
CREATE TABLE t_wallet_transfer (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    transfer_no VARCHAR(32) UNIQUE NOT NULL,
    from_user_id BIGINT NOT NULL,
    to_user_id BIGINT NOT NULL,
    amount DECIMAL(12,2) NOT NULL,
    fee DECIMAL(12,2) DEFAULT 0.00,
    actual_amount DECIMAL(12,2) NOT NULL,
    transfer_type TINYINT NOT NULL,
    transfer_status TINYINT DEFAULT 0,
    transfer_reason VARCHAR(200),
    remark VARCHAR(500),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_from_user (from_user_id),
    INDEX idx_to_user (to_user_id),
    INDEX idx_status (transfer_status),
    INDEX idx_create_time (create_time)
);
```

### ç§¯åˆ†è´¦æˆ·è¡¨ (t_points_account)
```sql
CREATE TABLE t_points_account (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    available_points BIGINT DEFAULT 0,
    frozen_points BIGINT DEFAULT 0,
    total_points BIGINT DEFAULT 0,
    total_earned BIGINT DEFAULT 0,
    total_consumed BIGINT DEFAULT 0,
    total_expired BIGINT DEFAULT 0,
    account_status TINYINT DEFAULT 1,
    version INT DEFAULT 0,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY uk_user_id (user_id)
);
```

### ç§¯åˆ†äº¤æ˜“è®°å½•è¡¨ (t_points_transaction)
```sql
CREATE TABLE t_points_transaction (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    transaction_no VARCHAR(32) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL,
    transaction_type TINYINT NOT NULL,
    points BIGINT NOT NULL,
    balance_before BIGINT NOT NULL,
    balance_after BIGINT NOT NULL,
    business_type TINYINT NOT NULL,
    business_id VARCHAR(64),
    business_no VARCHAR(64),
    expire_time DATETIME,
    transaction_status TINYINT DEFAULT 1,
    remark VARCHAR(500),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_business (business_type, business_id),
    INDEX idx_expire_time (expire_time),
    INDEX idx_create_time (create_time)
);
```

### ä¼˜æƒ åˆ¸æ¨¡æ¿è¡¨ (t_coupon_template)
```sql
CREATE TABLE t_coupon_template (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    template_name VARCHAR(100) NOT NULL,
    coupon_type TINYINT NOT NULL,
    discount_type TINYINT NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_order_amount DECIMAL(10,2) DEFAULT 0.00,
    max_discount_amount DECIMAL(10,2),
    total_quantity INT DEFAULT 0,
    issued_quantity INT DEFAULT 0,
    per_user_limit INT DEFAULT 1,
    valid_days INT NOT NULL,
    start_time DATETIME,
    end_time DATETIME,
    template_status TINYINT DEFAULT 1,
    description VARCHAR(500),
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### ç”¨æˆ·ä¼˜æƒ åˆ¸è¡¨ (t_user_coupon)
```sql
CREATE TABLE t_user_coupon (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    coupon_code VARCHAR(32) UNIQUE NOT NULL,
    user_id BIGINT NOT NULL,
    template_id BIGINT NOT NULL,
    coupon_name VARCHAR(100) NOT NULL,
    coupon_type TINYINT NOT NULL,
    discount_type TINYINT NOT NULL,
    discount_value DECIMAL(10,2) NOT NULL,
    min_order_amount DECIMAL(10,2) DEFAULT 0.00,
    max_discount_amount DECIMAL(10,2),
    coupon_status TINYINT DEFAULT 1,
    issue_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    start_time DATETIME NOT NULL,
    end_time DATETIME NOT NULL,
    use_time DATETIME,
    order_id BIGINT,
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_user_id (user_id),
    INDEX idx_template_id (template_id),
    INDEX idx_status (coupon_status),
    INDEX idx_end_time (end_time)
);
```

## ä¸šåŠ¡æµç¨‹

### é’±åŒ…å……å€¼æµç¨‹
1. **å‘èµ·å……å€¼**: ç”¨æˆ·é€‰æ‹©å……å€¼é‡‘é¢å’Œæ”¯ä»˜æ–¹å¼
2. **åˆ›å»ºå……å€¼å•**: ç³»ç»Ÿåˆ›å»ºå……å€¼è®°å½•
3. **è°ƒç”¨æ”¯ä»˜**: è°ƒç”¨ç¬¬ä¸‰æ–¹æ”¯ä»˜æ¥å£
4. **æ”¯ä»˜å›è°ƒ**: æ¥æ”¶æ”¯ä»˜ç»“æœå›è°ƒ
5. **ä½™é¢å…¥è´¦**: å……å€¼æˆåŠŸåå¢åŠ é’±åŒ…ä½™é¢
6. **å‘é€é€šçŸ¥**: å‘é€å……å€¼æˆåŠŸé€šçŸ¥

### é’±åŒ…æ”¯ä»˜æµç¨‹
1. **éªŒè¯æ”¯ä»˜å¯†ç **: éªŒè¯ç”¨æˆ·æ”¯ä»˜å¯†ç 
2. **æ£€æŸ¥ä½™é¢**: æ£€æŸ¥é’±åŒ…ä½™é¢æ˜¯å¦å……è¶³
3. **å†»ç»“é‡‘é¢**: å†»ç»“è®¢å•é‡‘é¢
4. **åˆ›å»ºæ”¯ä»˜å•**: åˆ›å»ºæ”¯ä»˜äº¤æ˜“è®°å½•
5. **æ‰£å‡ä½™é¢**: æ‰£å‡é’±åŒ…å¯ç”¨ä½™é¢
6. **æ”¯ä»˜å®Œæˆ**: æ ‡è®°æ”¯ä»˜å®ŒæˆçŠ¶æ€

### ç§¯åˆ†è·å¾—æµç¨‹
1. **è§¦å‘äº‹ä»¶**: ç”¨æˆ·æ¶ˆè´¹ç­‰è¡Œä¸ºè§¦å‘ç§¯åˆ†è·å¾—
2. **è®¡ç®—ç§¯åˆ†**: æ ¹æ®è§„åˆ™è®¡ç®—åº”å¾—ç§¯åˆ†
3. **ç§¯åˆ†å…¥è´¦**: å¢åŠ ç”¨æˆ·ç§¯åˆ†ä½™é¢
4. **è®¾ç½®è¿‡æœŸ**: è®¾ç½®ç§¯åˆ†è¿‡æœŸæ—¶é—´
5. **è®°å½•æµæ°´**: è®°å½•ç§¯åˆ†äº¤æ˜“æµæ°´
6. **å‘é€é€šçŸ¥**: å‘é€ç§¯åˆ†è·å¾—é€šçŸ¥

### ä¼˜æƒ åˆ¸ä½¿ç”¨æµç¨‹
1. **é€‰æ‹©ä¼˜æƒ åˆ¸**: ç”¨æˆ·é€‰æ‹©å¯ç”¨ä¼˜æƒ åˆ¸
2. **éªŒè¯æœ‰æ•ˆæ€§**: éªŒè¯ä¼˜æƒ åˆ¸æ˜¯å¦æœ‰æ•ˆ
3. **è®¡ç®—ä¼˜æƒ **: è®¡ç®—ä¼˜æƒ é‡‘é¢
4. **é”å®šä¼˜æƒ åˆ¸**: é”å®šä¼˜æƒ åˆ¸é˜²æ­¢é‡å¤ä½¿ç”¨
5. **è®¢å•æŠµæ‰£**: åœ¨è®¢å•ä¸­åº”ç”¨ä¼˜æƒ 
6. **æ ‡è®°å·²ä½¿ç”¨**: æ ‡è®°ä¼˜æƒ åˆ¸ä¸ºå·²ä½¿ç”¨çŠ¶æ€

## æ ¸å¿ƒæœåŠ¡å®ç°

### é’±åŒ…ä½™é¢æœåŠ¡
```java
@Service
public class WalletBalanceService {
    
    @Transactional
    public void increaseBalance(Long userId, BigDecimal amount, 
                               BusinessType businessType, String businessId) {
        // è·å–é’±åŒ…è´¦æˆ·
        WalletAccount account = getWalletAccount(userId);
        
        // ä¹è§‚é”æ›´æ–°ä½™é¢
        BigDecimal newAvailableBalance = account.getAvailableBalance().add(amount);
        BigDecimal newTotalBalance = account.getTotalBalance().add(amount);
        
        boolean updated = walletAccountMapper.updateBalance(
            account.getId(),
            newAvailableBalance,
            newTotalBalance,
            account.getVersion()
        );
        
        if (!updated) {
            throw new BusinessException("ä½™é¢æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // è®°å½•äº¤æ˜“æµæ°´
        recordTransaction(userId, TransactionType.INCOME, amount, 
                         account.getAvailableBalance(), newAvailableBalance,
                         businessType, businessId);
    }
    
    @Transactional
    public void decreaseBalance(Long userId, BigDecimal amount, 
                               BusinessType businessType, String businessId) {
        // è·å–é’±åŒ…è´¦æˆ·
        WalletAccount account = getWalletAccount(userId);
        
        // æ£€æŸ¥ä½™é¢æ˜¯å¦å……è¶³
        if (account.getAvailableBalance().compareTo(amount) < 0) {
            throw new BusinessException("ä½™é¢ä¸è¶³");
        }
        
        // ä¹è§‚é”æ›´æ–°ä½™é¢
        BigDecimal newAvailableBalance = account.getAvailableBalance().subtract(amount);
        BigDecimal newTotalBalance = account.getTotalBalance().subtract(amount);
        
        boolean updated = walletAccountMapper.updateBalance(
            account.getId(),
            newAvailableBalance,
            newTotalBalance,
            account.getVersion()
        );
        
        if (!updated) {
            throw new BusinessException("ä½™é¢æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // è®°å½•äº¤æ˜“æµæ°´
        recordTransaction(userId, TransactionType.EXPENSE, amount, 
                         account.getAvailableBalance(), newAvailableBalance,
                         businessType, businessId);
    }
    
    @Transactional
    public void freezeBalance(Long userId, BigDecimal amount, 
                             BusinessType businessType, String businessId) {
        // è·å–é’±åŒ…è´¦æˆ·
        WalletAccount account = getWalletAccount(userId);
        
        // æ£€æŸ¥å¯ç”¨ä½™é¢æ˜¯å¦å……è¶³
        if (account.getAvailableBalance().compareTo(amount) < 0) {
            throw new BusinessException("å¯ç”¨ä½™é¢ä¸è¶³");
        }
        
        // ä¹è§‚é”æ›´æ–°ä½™é¢
        BigDecimal newAvailableBalance = account.getAvailableBalance().subtract(amount);
        BigDecimal newFrozenBalance = account.getFrozenBalance().add(amount);
        
        boolean updated = walletAccountMapper.updateFreezeBalance(
            account.getId(),
            newAvailableBalance,
            newFrozenBalance,
            account.getVersion()
        );
        
        if (!updated) {
            throw new BusinessException("ä½™é¢å†»ç»“å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // è®°å½•äº¤æ˜“æµæ°´
        recordTransaction(userId, TransactionType.FREEZE, amount, 
                         account.getAvailableBalance(), newAvailableBalance,
                         businessType, businessId);
    }
}
```

### ç§¯åˆ†æœåŠ¡å®ç°
```java
@Service
public class PointsService {
    
    @Transactional
    public void earnPoints(Long userId, Long points, 
                          PointsEarnType earnType, String businessId) {
        // è·å–ç§¯åˆ†è´¦æˆ·
        PointsAccount account = getPointsAccount(userId);
        
        // è®¡ç®—è¿‡æœŸæ—¶é—´
        LocalDateTime expireTime = LocalDateTime.now().plusDays(pointsConfig.getExpireDays());
        
        // ä¹è§‚é”æ›´æ–°ç§¯åˆ†
        Long newAvailablePoints = account.getAvailablePoints() + points;
        Long newTotalPoints = account.getTotalPoints() + points;
        Long newTotalEarned = account.getTotalEarned() + points;
        
        boolean updated = pointsAccountMapper.updatePoints(
            account.getId(),
            newAvailablePoints,
            newTotalPoints,
            newTotalEarned,
            account.getVersion()
        );
        
        if (!updated) {
            throw new BusinessException("ç§¯åˆ†æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // è®°å½•ç§¯åˆ†æµæ°´
        recordPointsTransaction(userId, PointsTransactionType.EARN, points,
                               account.getAvailablePoints(), newAvailablePoints,
                               earnType.getBusinessType(), businessId, expireTime);
    }
    
    @Transactional
    public void consumePoints(Long userId, Long points, 
                             PointsConsumeType consumeType, String businessId) {
        // è·å–ç§¯åˆ†è´¦æˆ·
        PointsAccount account = getPointsAccount(userId);
        
        // æ£€æŸ¥ç§¯åˆ†æ˜¯å¦å……è¶³
        if (account.getAvailablePoints() < points) {
            throw new BusinessException("ç§¯åˆ†ä¸è¶³");
        }
        
        // æŒ‰ç…§å…ˆè¿›å…ˆå‡ºåŸåˆ™æ¶ˆè´¹ç§¯åˆ†
        List<PointsTransaction> availablePoints = getAvailablePointsOrderByExpire(userId);
        Long remainingPoints = points;
        
        for (PointsTransaction transaction : availablePoints) {
            if (remainingPoints <= 0) {
                break;
            }
            
            Long consumablePoints = Math.min(remainingPoints, transaction.getPoints());
            
            // æ›´æ–°ç§¯åˆ†äº¤æ˜“è®°å½•
            pointsTransactionMapper.updateConsumedPoints(
                transaction.getId(), 
                transaction.getConsumedPoints() + consumablePoints
            );
            
            remainingPoints -= consumablePoints;
        }
        
        // ä¹è§‚é”æ›´æ–°ç§¯åˆ†è´¦æˆ·
        Long newAvailablePoints = account.getAvailablePoints() - points;
        Long newTotalConsumed = account.getTotalConsumed() + points;
        
        boolean updated = pointsAccountMapper.updateConsumePoints(
            account.getId(),
            newAvailablePoints,
            newTotalConsumed,
            account.getVersion()
        );
        
        if (!updated) {
            throw new BusinessException("ç§¯åˆ†æ¶ˆè´¹å¤±è´¥ï¼Œè¯·é‡è¯•");
        }
        
        // è®°å½•ç§¯åˆ†æ¶ˆè´¹æµæ°´
        recordPointsTransaction(userId, PointsTransactionType.CONSUME, points,
                               account.getAvailablePoints(), newAvailablePoints,
                               consumeType.getBusinessType(), businessId, null);
    }
}
```

### ä¼˜æƒ åˆ¸æœåŠ¡å®ç°
```java
@Service
public class CouponService {
    
    @Transactional
    public CouponVO issueCoupon(Long userId, Long templateId, CouponIssueType issueType) {
        // è·å–ä¼˜æƒ åˆ¸æ¨¡æ¿
        CouponTemplate template = couponTemplateMapper.selectById(templateId);
        if (template == null) {
            throw new BusinessException("ä¼˜æƒ åˆ¸æ¨¡æ¿ä¸å­˜åœ¨");
        }
        
        // æ£€æŸ¥å‘æ”¾é™åˆ¶
        checkIssueLimit(userId, template);
        
        // ç”Ÿæˆä¼˜æƒ åˆ¸ç 
        String couponCode = generateCouponCode();
        
        // è®¡ç®—æœ‰æ•ˆæœŸ
        LocalDateTime startTime = LocalDateTime.now();
        LocalDateTime endTime = startTime.plusDays(template.getValidDays());
        
        // åˆ›å»ºç”¨æˆ·ä¼˜æƒ åˆ¸
        UserCoupon userCoupon = UserCoupon.builder()
            .couponCode(couponCode)
            .userId(userId)
            .templateId(templateId)
            .couponName(template.getTemplateName())
            .couponType(template.getCouponType())
            .discountType(template.getDiscountType())
            .discountValue(template.getDiscountValue())
            .minOrderAmount(template.getMinOrderAmount())
            .maxDiscountAmount(template.getMaxDiscountAmount())
            .couponStatus(CouponStatus.AVAILABLE)
            .startTime(startTime)
            .endTime(endTime)
            .build();
        
        userCouponMapper.insert(userCoupon);
        
        // æ›´æ–°æ¨¡æ¿å·²å‘æ”¾æ•°é‡
        couponTemplateMapper.increaseIssuedQuantity(templateId);
        
        return convertToVO(userCoupon);
    }
    
    @Transactional
    public CouponUseVO useCoupon(Long userId, Long couponId, Long orderId, BigDecimal orderAmount) {
        // è·å–ç”¨æˆ·ä¼˜æƒ åˆ¸
        UserCoupon coupon = userCouponMapper.selectByIdAndUserId(couponId, userId);
        if (coupon == null) {
            throw new BusinessException("ä¼˜æƒ åˆ¸ä¸å­˜åœ¨");
        }
        
        // éªŒè¯ä¼˜æƒ åˆ¸çŠ¶æ€
        validateCouponStatus(coupon, orderAmount);
        
        // è®¡ç®—ä¼˜æƒ é‡‘é¢
        BigDecimal discountAmount = calculateDiscountAmount(coupon, orderAmount);
        
        // æ›´æ–°ä¼˜æƒ åˆ¸çŠ¶æ€
        boolean updated = userCouponMapper.updateCouponUsed(
            couponId, 
            CouponStatus.USED, 
            LocalDateTime.now(), 
            orderId
        );
        
        if (!updated) {
            throw new BusinessException("ä¼˜æƒ åˆ¸ä½¿ç”¨å¤±è´¥");
        }
        
        return CouponUseVO.builder()
            .couponId(couponId)
            .couponCode(coupon.getCouponCode())
            .discountAmount(discountAmount)
            .build();
    }
    
    private BigDecimal calculateDiscountAmount(UserCoupon coupon, BigDecimal orderAmount) {
        BigDecimal discountAmount = BigDecimal.ZERO;
        
        if (coupon.getDiscountType() == DiscountType.FIXED_AMOUNT) {
            // å›ºå®šé‡‘é¢ä¼˜æƒ 
            discountAmount = coupon.getDiscountValue();
        } else if (coupon.getDiscountType() == DiscountType.PERCENTAGE) {
            // ç™¾åˆ†æ¯”ä¼˜æƒ 
            discountAmount = orderAmount.multiply(coupon.getDiscountValue())
                .divide(new BigDecimal("100"), 2, RoundingMode.HALF_UP);
            
            // æ£€æŸ¥æœ€å¤§ä¼˜æƒ é‡‘é¢é™åˆ¶
            if (coupon.getMaxDiscountAmount() != null && 
                discountAmount.compareTo(coupon.getMaxDiscountAmount()) > 0) {
                discountAmount = coupon.getMaxDiscountAmount();
            }
        }
        
        // ä¼˜æƒ é‡‘é¢ä¸èƒ½è¶…è¿‡è®¢å•é‡‘é¢
        if (discountAmount.compareTo(orderAmount) > 0) {
            discountAmount = orderAmount;
        }
        
        return discountAmount;
    }
}
```

## å®‰å…¨æœºåˆ¶

### æ”¯ä»˜å¯†ç å®‰å…¨
```java
@Service
public class PaymentSecurityService {
    
    public boolean verifyPaymentPassword(Long userId, String password) {
        WalletAccount account = getWalletAccount(userId);
        
        // æ£€æŸ¥è´¦æˆ·æ˜¯å¦è¢«é”å®š
        if (isAccountLocked(account)) {
            throw new BusinessException("è´¦æˆ·å·²è¢«é”å®šï¼Œè¯·ç¨åå†è¯•");
        }
        
        // éªŒè¯æ”¯ä»˜å¯†ç 
        boolean isValid = passwordEncoder.matches(password, account.getPaymentPassword());
        
        if (!isValid) {
            // å¢åŠ é”™è¯¯æ¬¡æ•°
            increasePasswordErrorCount(userId);
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦é”å®šè´¦æˆ·
            if (account.getPasswordErrorCount() + 1 >= securityConfig.getPasswordRetryLimit()) {
                lockAccount(userId);
                throw new BusinessException("å¯†ç é”™è¯¯æ¬¡æ•°è¿‡å¤šï¼Œè´¦æˆ·å·²è¢«é”å®š");
            }
            
            throw new BusinessException("æ”¯ä»˜å¯†ç é”™è¯¯");
        }
        
        // é‡ç½®é”™è¯¯æ¬¡æ•°
        resetPasswordErrorCount(userId);
        
        return true;
    }
    
    private void lockAccount(Long userId) {
        LocalDateTime lockTime = LocalDateTime.now().plusMinutes(securityConfig.getLockDuration());
        walletAccountMapper.lockAccount(userId, lockTime);
    }
    
    private boolean isAccountLocked(WalletAccount account) {
        return account.getPasswordLockTime() != null && 
               account.getPasswordLockTime().isAfter(LocalDateTime.now());
    }
}
```

### é£æ§æ£€æŸ¥
```java
@Service
public class WalletRiskService {
    
    public void checkTransferRisk(Long fromUserId, Long toUserId, BigDecimal amount) {
        // æ£€æŸ¥å•ç¬”è½¬è´¦é™é¢
        if (amount.compareTo(riskConfig.getSingleTransferLimit()) > 0) {
            throw new BusinessException("å•ç¬”è½¬è´¦é‡‘é¢è¶…è¿‡é™é¢");
        }
        
        // æ£€æŸ¥æ—¥è½¬è´¦é™é¢
        BigDecimal dailyTransferAmount = getDailyTransferAmount(fromUserId);
        if (dailyTransferAmount.add(amount).compareTo(riskConfig.getDailyTransferLimit()) > 0) {
            throw new BusinessException("æ—¥è½¬è´¦é‡‘é¢è¶…è¿‡é™é¢");
        }
        
        // æ£€æŸ¥è½¬è´¦é¢‘ç‡
        if (isFrequentTransfer(fromUserId)) {
            throw new BusinessException("è½¬è´¦è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•");
        }
        
        // æ£€æŸ¥å¯ç–‘è´¦æˆ·
        if (isSuspiciousAccount(fromUserId) || isSuspiciousAccount(toUserId)) {
            throw new BusinessException("è´¦æˆ·å­˜åœ¨é£é™©ï¼Œè½¬è´¦è¢«æ‹’ç»");
        }
    }
    
    private boolean isFrequentTransfer(Long userId) {
        String key = "transfer:count:" + userId;
        String count = redisTemplate.opsForValue().get(key);
        
        if (count == null) {
            redisTemplate.opsForValue().set(key, "1", Duration.ofMinutes(10));
            return false;
        }
        
        int currentCount = Integer.parseInt(count);
        if (currentCount >= riskConfig.getTransferFrequencyLimit()) {
            return true;
        }
        
        redisTemplate.opsForValue().increment(key);
        return false;
    }
}
```

## æ€§èƒ½ä¼˜åŒ–

### é’±åŒ…ä¼˜åŒ–
- ä½™é¢æŸ¥è¯¢ç¼“å­˜
- äº¤æ˜“è®°å½•åˆ†è¡¨
- æ‰¹é‡äº¤æ˜“å¤„ç†
- å¼‚æ­¥é€šçŸ¥å‘é€

### ç§¯åˆ†ä¼˜åŒ–
- ç§¯åˆ†è®¡ç®—ç¼“å­˜
- è¿‡æœŸç§¯åˆ†å®šæ—¶æ¸…ç†
- ç§¯åˆ†å…‘æ¢é¢„è®¡ç®—
- ç§¯åˆ†ç»Ÿè®¡å¼‚æ­¥æ›´æ–°

### ä¼˜æƒ åˆ¸ä¼˜åŒ–
- ä¼˜æƒ åˆ¸æ¨¡æ¿ç¼“å­˜
- ç”¨æˆ·ä¼˜æƒ åˆ¸ç´¢å¼•
- ä¼˜æƒ åˆ¸ä½¿ç”¨é¢„æ£€æŸ¥
- è¿‡æœŸä¼˜æƒ åˆ¸å®šæ—¶æ¸…ç†

## å®‰å…¨è€ƒè™‘

- ğŸ”’ æ”¯ä»˜å¯†ç åŠ å¯†å­˜å‚¨
- ğŸ”’ äº¤æ˜“é‡‘é¢ç²¾åº¦æ§åˆ¶
- ğŸ”’ å¹¶å‘æ“ä½œä¹è§‚é”
- ğŸ”’ æ•æ„Ÿæ“ä½œå®¡è®¡æ—¥å¿—
- ğŸ”’ å¼‚å¸¸äº¤æ˜“å®æ—¶ç›‘æ§

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜
1. **ä½™é¢ä¸ä¸€è‡´**: æ£€æŸ¥äº¤æ˜“æµæ°´å’Œè´¦æˆ·ä½™é¢
2. **æ”¯ä»˜å¤±è´¥**: æ£€æŸ¥æ”¯ä»˜å¯†ç å’Œè´¦æˆ·çŠ¶æ€
3. **ç§¯åˆ†å¼‚å¸¸**: æ£€æŸ¥ç§¯åˆ†è§„åˆ™å’Œè¿‡æœŸæ—¶é—´
4. **ä¼˜æƒ åˆ¸æ— æ•ˆ**: æ£€æŸ¥ä¼˜æƒ åˆ¸çŠ¶æ€å’Œä½¿ç”¨æ¡ä»¶

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/wallet-provider.log

# æŸ¥çœ‹é’±åŒ…äº¤æ˜“æ—¥å¿—
grep "WALLET_TRANSACTION" logs/wallet-provider.log

# æŸ¥çœ‹ç§¯åˆ†æ—¥å¿—
grep "POINTS" logs/wallet-provider.log

# æŸ¥çœ‹ä¼˜æƒ åˆ¸æ—¥å¿—
grep "COUPON" logs/wallet-provider.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/wallet-provider.log
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„äº¤æ˜“ç±»å‹
1. å®šä¹‰äº¤æ˜“ç±»å‹æšä¸¾
2. å®ç°äº¤æ˜“å¤„ç†é€»è¾‘
3. æ·»åŠ äº¤æ˜“éªŒè¯è§„åˆ™
4. æ›´æ–°äº¤æ˜“æµæ°´è®°å½•
5. æ·»åŠ å•å…ƒæµ‹è¯•

### æ‰©å±•ç§¯åˆ†è§„åˆ™
1. å®šä¹‰ç§¯åˆ†è·å¾—è§„åˆ™
2. å®ç°ç§¯åˆ†è®¡ç®—é€»è¾‘
3. é…ç½®ç§¯åˆ†æœ‰æ•ˆæœŸ
4. æ·»åŠ ç§¯åˆ†ç›‘æ§
5. æµ‹è¯•ç§¯åˆ†åŠŸèƒ½

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: 1.0.0
- **æœ€ä½ JDK ç‰ˆæœ¬**: 17
- **Spring Boot ç‰ˆæœ¬**: 3.x
- **Spring Cloud ç‰ˆæœ¬**: 2023.x

---

**ç»´æŠ¤å›¢é˜Ÿ**: å…±äº«è‡»é€‰å¼€å‘å›¢é˜Ÿ  
**åˆ›å»ºæ—¶é—´**: 2024å¹´  
**æœ€åæ›´æ–°**: 2024å¹´