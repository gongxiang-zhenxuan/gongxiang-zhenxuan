# éª‘æ‰‹æœåŠ¡æ”¶å…¥åˆ†é…è§„åˆ™è®¾è®¡

## ğŸ“‹ ä¸šåŠ¡èƒŒæ™¯

æš¹ç½—å¤–å–ç³»ç»Ÿé‡‡ç”¨å•†å®¶è‡ªé…é€/å¹³å°é…é€å¹¶å­˜æ¨¡å¼ï¼Œéœ€å¯¹å¹³å°ã€å•†å®¶ã€éª‘æ‰‹è¿›è¡Œåˆç†ç»“ç®—ã€‚ä¸ºæ»¡è¶³ä¸åŒå•†å®¶çš„å•†åŠ¡æ”¿ç­–ï¼ŒæŠ½æˆæ¯”ä¾‹æ”¯æŒ**æŒ‰å•†æˆ·å•ç‹¬é…ç½®**ï¼ˆä¾‹å¦‚ï¼šå•†å®¶1=20%ï¼‰ï¼ŒåŒæ—¶é…é€ç¯èŠ‚çš„æŠ½æˆæ¯”ä¾‹å¯ç‹¬ç«‹é…ç½®ã€‚

## ğŸ¯ æ ¸å¿ƒè§„åˆ™

### æ”¶å…¥åˆ†é…åŸåˆ™
- **åˆ†é¡¹æŠ½æˆ**ï¼š
  - å•†å“ä¾§æŠ½æˆæ¯”ä¾‹=`merchant_commission_ratio`ï¼ˆå¯æŒ‰å•†æˆ·é…ç½®ï¼‰
  - é…é€ä¾§æŠ½æˆæ¯”ä¾‹=`delivery_commission_ratio`ï¼ˆå¹³å°ç»Ÿä¸€ï¼Œæˆ–æŒ‰åŒºåŸŸ/æ´»åŠ¨é…ç½®ï¼‰
- **ç»Ÿä¸€å£å¾„**ï¼šæ‰€æœ‰è®¡ç®—åŸºäºç”¨æˆ·å®é™…æ”¯ä»˜é‡‘é¢ï¼ˆå•†å“å®ä»˜ã€é…é€è´¹åˆ†åˆ«è®¡ç®—ï¼‰ã€‚
- **å¯è¿½æº¯**ï¼šè®¢å•ç»´åº¦è½åº“å…·ä½“æ¯”ä¾‹ï¼Œæ”¯æŒäº‹åå®¡è®¡ä¸å¯¹è´¦ã€‚

### è®¡ç®—å…¬å¼

```
ç”¨æˆ·å®é™…æ”¯ä»˜æ€»é‡‘é¢ = å•†å“å®ä»˜é‡‘é¢ + é…é€è´¹
å¹³å°æ”¶å…¥ = å•†å“å®ä»˜é‡‘é¢ Ã— å•†æˆ·æŠ½æˆæ¯”ä¾‹(merchant_commission_ratio)
         + é…é€è´¹ Ã— é…é€æŠ½æˆæ¯”ä¾‹(delivery_commission_ratio)
å•†å®¶å®é™…æ”¶å…¥ = å•†å“å®ä»˜é‡‘é¢ Ã— (1 - merchant_commission_ratio)
éª‘æ‰‹å®é™…æ”¶å…¥ = é…é€è´¹ Ã— (1 - delivery_commission_ratio)
```

## ğŸ’° æ”¶å…¥åˆ†é…ç¤ºä¾‹

- å•†å“åŸä»·ï¼š30å…ƒ
- ä½¿ç”¨ä¼˜æƒ åˆ¸ï¼š10å…ƒ
- å•†å“å®ä»˜ï¼š20å…ƒ
- é…é€è´¹ï¼š2å…ƒ
- å•†æˆ·æŠ½æˆæ¯”ä¾‹ï¼š20%
- é…é€æŠ½æˆæ¯”ä¾‹ï¼š10%

åˆ†é…ç»“æœï¼š
```
å¹³å°æ”¶å…¥ = 20Ã—20% + 2Ã—10% = 4.0 + 0.2 = 4.2å…ƒ
å•†å®¶æ”¶å…¥ = 20Ã—(1-20%) = 16.0å…ƒ
éª‘æ‰‹æ”¶å…¥ = 2Ã—(1-10%) = 1.8å…ƒ
æ ¡éªŒï¼š4.2 + 16.0 + 1.8 = 22å…ƒ = ç”¨æˆ·æ€»æ”¯ä»˜
```

## ğŸ“Š æ”¶å…¥åˆ†é…å¯è§†åŒ–

```mermaid
graph LR
    A["è®¢å•æ€»é‡‘é¢<br/>å•†å“å®ä»˜20å…ƒ + é…é€è´¹2å…ƒ = 22å…ƒ"] --> B["å•†æˆ·æŠ½æˆ20%<br/>é…é€æŠ½æˆ10%"]
    B --> C["å¹³å°æ”¶å…¥<br/>å•†å“4.0 + é…é€0.2 = 4.2å…ƒ"]
    B --> D["å•†å®¶æ”¶å…¥<br/>20Ã—80%=16.0å…ƒ"]
    B --> E["éª‘æ‰‹æ”¶å…¥<br/>2Ã—90%=1.8å…ƒ"]
```

## ğŸ—ï¸ æ ¸å¿ƒè½åº“è®¾è®¡

åœ¨è®¢å•ç»´åº¦è½åº“å½“æ¬¡ç»“ç®—æ‰€ä½¿ç”¨çš„æ¯”ä¾‹ï¼Œé¿å…åç»­æ¯”ä¾‹è°ƒæ•´å¯¼è‡´å†å²è®¡ç®—é‡æ”¾åå·®ã€‚

```sql
-- tb_order æ–°å¢/è°ƒæ•´å­—æ®µ
`goods_actual_amount` decimal(10,2) COMMENT 'å•†å“å®ä»˜é‡‘é¢(æ‰£é™¤ä¼˜æƒ å)',
`delivery_fee` decimal(10,2) COMMENT 'é…é€è´¹',
`total_actual_amount` decimal(10,2) COMMENT 'ç”¨æˆ·å®é™…æ”¯ä»˜æ€»é‡‘é¢',
`merchant_commission_ratio` decimal(5,2) COMMENT 'å•†æˆ·æŠ½æˆæ¯”ä¾‹(%)ï¼Œä¸‹å•æ—¶é”å®š',
`delivery_commission_ratio` decimal(5,2) COMMENT 'é…é€æŠ½æˆæ¯”ä¾‹(%)ï¼Œä¸‹å•æ—¶é”å®š',
`platform_total_income` decimal(10,2) COMMENT 'å¹³å°æ€»æ”¶å…¥(å•†å“+é…é€)',
`merchant_actual_income` decimal(10,2) COMMENT 'å•†å®¶å®é™…æ”¶å…¥',
`courier_actual_income` decimal(10,2) COMMENT 'éª‘æ‰‹å®é™…æ”¶å…¥'
```

å•†æˆ·ç»´åº¦é…ç½®ï¼š
```sql
-- tb_merchant æ–°å¢å­—æ®µ
`merchant_commission_ratio` decimal(5,2) DEFAULT 20.00 COMMENT 'å•†æˆ·é»˜è®¤æŠ½æˆæ¯”ä¾‹(%)'
```

## âš™ï¸ æŠ€æœ¯å®ç°ï¼ˆå…³é”®ç‰‡æ®µï¼‰

```java
public class IncomeDistributionCalculator {
    public DistributionResult calculate(BigDecimal goodsActualAmount,
                                        BigDecimal deliveryFee,
                                        BigDecimal merchantRatioPct,
                                        BigDecimal deliveryRatioPct) {
        BigDecimal merchantRatio = merchantRatioPct.divide(BigDecimal.valueOf(100), 4, RoundingMode.HALF_UP);
        BigDecimal deliveryRatio = deliveryRatioPct.divide(BigDecimal.valueOf(100), 4, RoundingMode.HALF_UP);

        BigDecimal platformFromGoods = goodsActualAmount.multiply(merchantRatio);
        BigDecimal platformFromDelivery = deliveryFee.multiply(deliveryRatio);
        BigDecimal platformIncome = platformFromGoods.add(platformFromDelivery);

        BigDecimal merchantIncome = goodsActualAmount.multiply(BigDecimal.ONE.subtract(merchantRatio));
        BigDecimal courierIncome = deliveryFee.multiply(BigDecimal.ONE.subtract(deliveryRatio));
        return new DistributionResult(platformIncome, merchantIncome, courierIncome);
    }
}
```

ä¸‹å•æ—¶é”å®šæ¯”ä¾‹ï¼š
```java
// è¯»å–å•†æˆ·æŠ½æˆæ¯”ä¾‹ï¼ˆè‹¥å•†æˆ·æœªé…ç½®åˆ™ä½¿ç”¨å¹³å°é»˜è®¤ï¼‰
BigDecimal merchantRatio = Optional.ofNullable(merchant.getCommissionRatio())
    .orElse(platformDefaultMerchantRatio);

// é…é€æŠ½æˆæ¯”ä¾‹ï¼ˆå…¨å±€æˆ–æŒ‰åŸå¸‚ï¼‰
BigDecimal deliveryRatio = platformDeliveryRatio;

order.setMerchantCommissionRatio(merchantRatio);
order.setDeliveryCommissionRatio(deliveryRatio);
```

## ğŸ”§ é…ç½®å‚æ•°å»ºè®®

```yaml
commission:
  merchant-default: 20.0   # å•†æˆ·é»˜è®¤æŠ½æˆæ¯”ä¾‹(%)ï¼Œå¯è¢«å•†æˆ·è‡ªå®šä¹‰è¦†ç›–
  delivery-default: 10.0   # é…é€æŠ½æˆæ¯”ä¾‹(%)
```

---
**è¦ç‚¹**ï¼šæŠ½æˆæ¯”ä¾‹â€œå½“æ¬¡è®¢å•é”å®šå…¥åº“ + å•†æˆ·çº§å¯é…ç½®â€ï¼Œä¿è¯çµæ´»æ€§ä¸å¯è¿½æº¯æ€§ã€‚
