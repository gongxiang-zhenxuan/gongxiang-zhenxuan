# å¤–å–å¹³å°å¾®æœåŠ¡æ¶æ„æ–¹æ¡ˆ - å¯è§†åŒ–è®¾è®¡

## 1. æœåŠ¡æ‹†åˆ†æ€»è§ˆè¡¨

| æœåŠ¡åç§° | ç«¯å£ | æ ¸å¿ƒèŒè´£ | æ•°æ®ownership | ä¸»è¦å¯¹å¤–APIæ•°é‡ | éƒ¨ç½²ä¼˜å…ˆçº§ |
|---------|------|----------|---------------|----------------|------------|
| `gateway-service` | 8080 | ç»Ÿä¸€å…¥å£æ§åˆ¶ | æ— ä¸šåŠ¡æ•°æ® | è·¯ç”±è½¬å‘ | â­â­â­ æœ€é«˜ |
| `user-service` | 8081 | ç”¨æˆ·è´¦æˆ·ç®¡ç† | ç”¨æˆ·ä¿¡æ¯ã€åœ°å€ä¿¡æ¯ | 8ä¸ª | â­â­â­ æœ€é«˜ |
| `merchant-service` | 8082 | å•†æˆ·å•†å“ç®¡ç† | å•†æˆ·ä¿¡æ¯ã€å•†å“ä¿¡æ¯ã€åº“å­˜ | 12ä¸ª | â­â­â­ æœ€é«˜ |
| `order-service` | 8083 | è®¢å•äº¤æ˜“ç®¡ç† | è®¢å•ä¿¡æ¯ã€æ”¯ä»˜è®°å½• | 10ä¸ª | â­â­â­ æœ€é«˜ |
| `delivery-service` | 8084 | é…é€å±¥çº¦ç®¡ç† | éª‘æ‰‹ä¿¡æ¯ã€é…é€ä»»åŠ¡ | 9ä¸ª | â­â­ é«˜ |
| `promotion-service` | 8085 | è¥é”€ä¿ƒé”€ç®¡ç† | ä¼˜æƒ åˆ¸ã€æ´»åŠ¨è§„åˆ™ | 7ä¸ª | â­ ä¸­ |
| `wallet-service` | 8086 | é’±åŒ…è´¢åŠ¡ç®¡ç† | è´¦æˆ·ä½™é¢ã€èµ„é‡‘æµæ°´ | 6ä¸ª | â­â­ é«˜ |
| `admin-service` | 8087 | è¿è¥ç®¡ç†å·¥å…· | æƒé™ä¿¡æ¯ã€ç³»ç»Ÿé…ç½® | 15ä¸ª | â­ ä¸­ |

## 2. æœåŠ¡èŒè´£çŸ©é˜µè¡¨

| åŠŸèƒ½é¢†åŸŸ | Gateway | User | Merchant | Order | Delivery | Promotion | Wallet | Admin |
|---------|---------|------|----------|-------|----------|-----------|---------|-------|
| **ç”¨æˆ·ç®¡ç†** | è·¯ç”± | âœ…ä¸»è´£ | - | - | - | - | - | ğŸ“Šç»Ÿè®¡ |
| **å•†æˆ·ç®¡ç†** | è·¯ç”± | - | âœ…ä¸»è´£ | - | - | - | - | ğŸ“Šå®¡æ ¸ |
| **å•†å“ç®¡ç†** | è·¯ç”± | - | âœ…ä¸»è´£ | ğŸ”—è°ƒç”¨ | - | - | - | ğŸ“Šç»Ÿè®¡ |
| **è®¢å•ç®¡ç†** | è·¯ç”± | - | - | âœ…ä¸»è´£ | ğŸ“¤äº‹ä»¶ | ğŸ”—è°ƒç”¨ | ğŸ“¤äº‹ä»¶ | ğŸ“Šç»Ÿè®¡ |
| **æ”¯ä»˜ç®¡ç†** | è·¯ç”± | - | - | âœ…ä¸»è´£ | - | ğŸ”—è°ƒç”¨ | ğŸ“¤äº‹ä»¶ | ğŸ“Šç»Ÿè®¡ |
| **é…é€ç®¡ç†** | è·¯ç”± | - | - | ğŸ“¤äº‹ä»¶ | âœ…ä¸»è´£ | - | ğŸ“¤äº‹ä»¶ | ğŸ“Šç»Ÿè®¡ |
| **è¥é”€ç®¡ç†** | è·¯ç”± | - | - | ğŸ”—è°ƒç”¨ | - | âœ…ä¸»è´£ | - | ğŸ“Šé…ç½® |
| **è´¢åŠ¡ç®¡ç†** | è·¯ç”± | - | - | - | - | - | âœ…ä¸»è´£ | ğŸ“Šç»Ÿè®¡ |
| **æƒé™ç®¡ç†** | ğŸ”’é‰´æƒ | - | - | - | - | - | - | âœ…ä¸»è´£ |

**å›¾ä¾‹**ï¼šâœ…ä¸»è´£ ğŸ”—åŒæ­¥è°ƒç”¨ ğŸ“¤å¼‚æ­¥äº‹ä»¶ ğŸ“Šæ•°æ®ç»Ÿè®¡ ğŸ”’æƒé™æ§åˆ¶

## 3. æœåŠ¡ä¾èµ–å…³ç³»å›¾

```mermaid
graph TD
    %% å®¢æˆ·ç«¯å±‚
    subgraph "å®¢æˆ·ç«¯åº”ç”¨"
        A1[ç”¨æˆ·å°ç¨‹åº]
        A2[éª‘æ‰‹å°ç¨‹åº] 
        A3[å•†æˆ·å°ç¨‹åº]
        A4[ç®¡ç†åå°]
    end

    %% ç½‘å…³å±‚
    subgraph "æ¥å…¥å±‚"
        B[Gateway Service<br/>:8080]
    end

    %% ä¸šåŠ¡æœåŠ¡å±‚
    subgraph "ä¸šåŠ¡æœåŠ¡å±‚"
        C1[User Service<br/>:8081<br/>ç”¨æˆ·è´¦æˆ·]
        C2[Merchant Service<br/>:8082<br/>å•†æˆ·å•†å“]
        C3[Order Service<br/>:8083<br/>è®¢å•äº¤æ˜“]
        C4[Delivery Service<br/>:8084<br/>é…é€å±¥çº¦]
        C5[Promotion Service<br/>:8085<br/>è¥é”€ä¿ƒé”€]
        C6[Wallet Service<br/>:8086<br/>é’±åŒ…è´¢åŠ¡]
        C7[Admin Service<br/>:8087<br/>è¿è¥ç®¡ç†]
    end

    %% åŸºç¡€è®¾æ–½å±‚
    subgraph "åŸºç¡€è®¾æ–½"
        D1[(MySQL)]
        D2[(Redis)]
        D3[RabbitMQ]
        D4[å¾®ä¿¡æ”¯ä»˜API]
    end

    %% å®¢æˆ·ç«¯åˆ°ç½‘å…³
    A1 --> B
    A2 --> B
    A3 --> B
    A4 --> B

    %% ç½‘å…³åˆ°æœåŠ¡
    B --> C1
    B --> C2
    B --> C3
    B --> C4
    B --> C5
    B --> C6
    B --> C7

    %% æœåŠ¡é—´åŒæ­¥è°ƒç”¨ï¼ˆå®çº¿ï¼‰
    C3 -.->|è·å–ç”¨æˆ·åœ°å€| C1
    C3 -.->|æ ¡éªŒå•†å“åº“å­˜| C2
    C3 -.->|ä»·æ ¼è®¡ç®—| C5
    C7 -.->|æ•°æ®ç»Ÿè®¡| C1
    C7 -.->|æ•°æ®ç»Ÿè®¡| C2
    C7 -.->|æ•°æ®ç»Ÿè®¡| C3
    C7 -.->|æ•°æ®ç»Ÿè®¡| C4
    C7 -.->|æ•°æ®ç»Ÿè®¡| C6

    %% æœåŠ¡é—´å¼‚æ­¥äº‹ä»¶ï¼ˆè™šçº¿ï¼‰
    C3 ==>|è®¢å•äº‹ä»¶| D3
    D3 ==>|æ–°é…é€ä»»åŠ¡| C4
    D3 ==>|èµ„é‡‘å˜åŠ¨| C6

    %% æœåŠ¡åˆ°åŸºç¡€è®¾æ–½
    C1 --> D1
    C2 --> D1
    C3 --> D1
    C4 --> D1
    C5 --> D1
    C6 --> D1
    C7 --> D1

    C1 --> D2
    C3 --> D2
    C4 --> D2
    C5 --> D2

    C3 --> D4

    %% æ ·å¼å®šä¹‰
    classDef client fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef gateway fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef service fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef infrastructure fill:#fff3e0,stroke:#e65100,stroke-width:2px

    class A1,A2,A3,A4 client
    class B gateway
    class C1,C2,C3,C4,C5,C6,C7 service
    class D1,D2,D3,D4 infrastructure
```

**å›¾ä¾‹è¯´æ˜**ï¼š
- **å®çº¿ç®­å¤´**: ç›´æ¥APIè°ƒç”¨
- **è™šçº¿ç®­å¤´**: åŒæ­¥è°ƒç”¨ï¼ˆå¿…é¡»ç­‰å¾…å“åº”ï¼‰
- **åŒçº¿ç®­å¤´**: å¼‚æ­¥äº‹ä»¶é€šä¿¡ï¼ˆé€šè¿‡MQï¼‰

## 4. æ ¸å¿ƒä¸šåŠ¡æµç¨‹å›¾

### 4.1 ç”¨æˆ·ä¸‹å•æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·å°ç¨‹åº
    participant G as Gateway<br/>:8080
    participant US as User Service<br/>:8081
    participant MS as Merchant Service<br/>:8082
    participant PS as Promotion Service<br/>:8085
    participant OS as Order Service<br/>:8083
    participant MQ as RabbitMQ
    participant DS as Delivery Service<br/>:8084
    participant WS as Wallet Service<br/>:8086

    Note over U: ç”¨æˆ·é€‰æ‹©å•†å“ï¼Œç‚¹å‡»ä¸‹å•

    U->>G: 1. æäº¤è®¢å•è¯·æ±‚
    G->>OS: è·¯ç”±åˆ°è®¢å•æœåŠ¡

    Note over OS: è®¢å•æœåŠ¡åè°ƒæ•´ä¸ªä¸‹å•æµç¨‹

    OS->>US: 2. è·å–ç”¨æˆ·é…é€åœ°å€
    US-->>OS: è¿”å›åœ°å€ä¿¡æ¯

    OS->>MS: 3. æ ¡éªŒå•†å“ä¿¡æ¯å’Œåº“å­˜
    MS-->>OS: è¿”å›å•†å“è¯¦æƒ…ï¼Œæ‰£å‡åº“å­˜

    OS->>PS: 4. è®¡ç®—è®¢å•ä»·æ ¼ï¼ˆå«ä¼˜æƒ ï¼‰
    PS-->>OS: è¿”å›æœ€ç»ˆä»·æ ¼

    OS->>OS: 5. åˆ›å»ºè®¢å•è®°å½•

    OS->>OS: 6. è°ƒç”¨å¾®ä¿¡æ”¯ä»˜API
    OS-->>G: è¿”å›æ”¯ä»˜å‚æ•°
    G-->>U: è¿”å›æ”¯ä»˜ä¿¡æ¯

    Note over U: ç”¨æˆ·å®Œæˆå¾®ä¿¡æ”¯ä»˜

    U->>G: 7. æ”¯ä»˜æˆåŠŸå›è°ƒ
    G->>OS: å¤„ç†æ”¯ä»˜å›è°ƒ
    OS->>OS: æ›´æ–°è®¢å•çŠ¶æ€ä¸ºå·²æ”¯ä»˜

    Note over OS: æ”¯ä»˜æˆåŠŸåï¼Œå¼‚æ­¥é€šçŸ¥ç›¸å…³æœåŠ¡

    OS->>MQ: 8. å‘é€è®¢å•æ”¯ä»˜æˆåŠŸäº‹ä»¶
    MQ->>DS: é€šçŸ¥é…é€æœåŠ¡ï¼ˆæ–°é…é€ä»»åŠ¡ï¼‰
    MQ->>WS: é€šçŸ¥é’±åŒ…æœåŠ¡ï¼ˆèµ„é‡‘å˜åŠ¨ï¼‰

    DS->>DS: åˆ›å»ºé…é€ä»»åŠ¡ï¼Œç­‰å¾…éª‘æ‰‹æŠ¢å•
    WS->>WS: æ›´æ–°å•†æˆ·æ”¶å…¥ï¼Œæ‰£é™¤å¹³å°æœåŠ¡è´¹

    Note over U: ç”¨æˆ·å¯æŸ¥çœ‹è®¢å•çŠ¶æ€ï¼Œç­‰å¾…é…é€
```

### 4.2 éª‘æ‰‹é…é€æµç¨‹

```mermaid
sequenceDiagram
    participant R as éª‘æ‰‹å°ç¨‹åº
    participant G as Gateway<br/>:8080
    participant DS as Delivery Service<br/>:8084
    participant MQ as RabbitMQ
    participant OS as Order Service<br/>:8083
    participant WS as Wallet Service<br/>:8086

    Note over R: éª‘æ‰‹æŸ¥çœ‹å¾…æŠ¢è®¢å•

    R->>G: 1. æŸ¥è¯¢é™„è¿‘å¾…æŠ¢è®¢å•
    G->>DS: è·¯ç”±åˆ°é…é€æœåŠ¡
    DS-->>G: è¿”å›è®¢å•åˆ—è¡¨
    G-->>R: æ˜¾ç¤ºå¯æŠ¢è®¢å•

    R->>G: 2. é€‰æ‹©è®¢å•è¿›è¡ŒæŠ¢å•
    G->>DS: æŠ¢å•è¯·æ±‚
    DS->>DS: åˆ†å¸ƒå¼é”ï¼Œæ£€æŸ¥è®¢å•çŠ¶æ€
    DS->>DS: åˆ†é…è®¢å•ç»™éª‘æ‰‹
    DS-->>G: æŠ¢å•æˆåŠŸ
    G-->>R: è¿”å›é…é€ä»»åŠ¡è¯¦æƒ…

    Note over R: éª‘æ‰‹å‰å¾€å•†å®¶å–é¤

    R->>G: 3. æ›´æ–°é…é€çŠ¶æ€ï¼šå·²å–é¤
    G->>DS: æ›´æ–°é…é€çŠ¶æ€
    DS->>MQ: å‘é€çŠ¶æ€å˜æ›´äº‹ä»¶
    MQ->>OS: é€šçŸ¥è®¢å•æœåŠ¡æ›´æ–°çŠ¶æ€

    Note over R: éª‘æ‰‹é…é€ä¸­

    R->>G: 4. å®æ—¶ä½ç½®ä¸ŠæŠ¥
    G->>DS: æ›´æ–°éª‘æ‰‹ä½ç½®

    R->>G: 5. æ›´æ–°é…é€çŠ¶æ€ï¼šå·²é€è¾¾
    G->>DS: é…é€å®Œæˆ
    DS->>DS: è®¡ç®—é…é€è´¹æ”¶å…¥

    DS->>MQ: 6. å‘é€é…é€å®Œæˆäº‹ä»¶
    MQ->>OS: é€šçŸ¥è®¢å•æœåŠ¡ï¼ˆè®¢å•å®Œæˆï¼‰
    MQ->>WS: é€šçŸ¥é’±åŒ…æœåŠ¡ï¼ˆéª‘æ‰‹ç»“ç®—ï¼‰

    OS->>OS: è®¢å•çŠ¶æ€æ”¹ä¸ºå·²å®Œæˆ
    WS->>WS: å¢åŠ éª‘æ‰‹æ”¶å…¥è´¦æˆ·ä½™é¢

    Note over R: éª‘æ‰‹å¯æŸ¥çœ‹æ”¶å…¥æ˜ç»†
```

### 4.3 å•†æˆ·ç®¡ç†æµç¨‹

```mermaid
sequenceDiagram
    participant M as å•†æˆ·å°ç¨‹åº
    participant G as Gateway<br/>:8080
    participant MS as Merchant Service<br/>:8082
    participant OS as Order Service<br/>:8083
    participant AS as Admin Service<br/>:8087

    Note over M: å•†æˆ·æ—¥å¸¸ç»è¥ç®¡ç†

    M->>G: 1. æŸ¥çœ‹ä»Šæ—¥è®¢å•
    G->>OS: æŸ¥è¯¢å•†æˆ·è®¢å•
    OS-->>G: è¿”å›è®¢å•åˆ—è¡¨
    G-->>M: æ˜¾ç¤ºè®¢å•ä¿¡æ¯

    M->>G: 2. æ¥å—/æ‹’ç»è®¢å•
    G->>OS: æ›´æ–°è®¢å•çŠ¶æ€
    OS-->>G: çŠ¶æ€æ›´æ–°æˆåŠŸ
    G-->>M: æ“ä½œæˆåŠŸ

    M->>G: 3. ç®¡ç†å•†å“ï¼ˆä¸Šæ¶/ä¸‹æ¶/æ”¹ä»·ï¼‰
    G->>MS: å•†å“ç®¡ç†æ“ä½œ
    MS->>MS: æ›´æ–°å•†å“ä¿¡æ¯
    MS-->>G: æ“ä½œæˆåŠŸ
    G-->>M: å•†å“æ›´æ–°æˆåŠŸ

    M->>G: 4. åˆ‡æ¢è¥ä¸šçŠ¶æ€
    G->>MS: æ›´æ–°è¥ä¸šçŠ¶æ€
    MS-->>G: çŠ¶æ€æ›´æ–°æˆåŠŸ
    G-->>M: è¥ä¸šçŠ¶æ€å·²æ›´æ–°

    Note over AS: åå°ç®¡ç†å‘˜ç›‘æ§

    AS->>MS: 5. å®šæœŸç»Ÿè®¡å•†æˆ·ç»è¥æ•°æ®
    MS-->>AS: è¿”å›å•†æˆ·ç»Ÿè®¡ä¿¡æ¯

    AS->>OS: 6. ç»Ÿè®¡è®¢å•äº¤æ˜“æ•°æ®
    OS-->>AS: è¿”å›äº¤æ˜“ç»Ÿè®¡
```

## 5. æ•°æ®æµè½¬å›¾

```mermaid
flowchart TD
    subgraph "ç”¨æˆ·ç«¯äº¤äº’"
        A[ç”¨æˆ·å°ç¨‹åº] --> B[é€‰æ‹©å•†å“]
        B --> C[ç¡®è®¤è®¢å•]
        C --> D[å‘èµ·æ”¯ä»˜]
    end

    subgraph "è®¢å•å¤„ç†æ ¸å¿ƒ"
        E[Order Service] --> F{åº“å­˜æ£€æŸ¥}
        F -->|å……è¶³| G[ä»·æ ¼è®¡ç®—]
        F -->|ä¸è¶³| H[åº“å­˜ä¸è¶³]
        G --> I[åˆ›å»ºè®¢å•]
        I --> J[è°ƒç”¨æ”¯ä»˜]
    end

    subgraph "æ”¯ä»˜æˆåŠŸå"
        K[æ”¯ä»˜å›è°ƒ] --> L[MQäº‹ä»¶]
        L --> M[é…é€ä»»åŠ¡]
        L --> N[èµ„é‡‘ç»“ç®—]
        L --> O[åº“å­˜æ‰£å‡]
    end

    subgraph "å±¥çº¦é˜¶æ®µ"
        P[éª‘æ‰‹æŠ¢å•] --> Q[å•†å®¶å‡ºé¤]
        Q --> R[å¼€å§‹é…é€]
        R --> S[é…é€å®Œæˆ]
        S --> T[è®¢å•å®Œæˆ]
    end

    %% è¿æ¥å„ä¸ªé˜¶æ®µ
    D --> E
    J --> K
    M --> P
    T --> U[ç»“ç®—åˆ†è´¦]

    %% æ ·å¼
    classDef userAction fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef orderProcess fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef asyncProcess fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef fulfillment fill:#fce4ec,stroke:#c2185b,stroke-width:2px

    class A,B,C,D userAction
    class E,F,G,I,J orderProcess
    class K,L,M,N,O asyncProcess
    class P,Q,R,S,T fulfillment
```

## 6. æœåŠ¡èƒ½åŠ›è¯„ä¼°è¡¨

| æœåŠ¡ | é¢„ä¼°QPS | ä¸»è¦ç“¶é¢ˆ | æ‰©å±•æ–¹æ¡ˆ | ç›‘æ§é‡ç‚¹ |
|------|---------|----------|----------|----------|
| Gateway | 1000+ | CPU/å†…å­˜ | å¤šå®ä¾‹+è´Ÿè½½å‡è¡¡ | å“åº”æ—¶é—´ã€é”™è¯¯ç‡ |
| User | 200 | æ•°æ®åº“è¿æ¥ | è¯»å†™åˆ†ç¦»+ç¼“å­˜ | ç™»å½•æˆåŠŸç‡ |
| Merchant | 300 | å•†å“æŸ¥è¯¢ | Redisç¼“å­˜ | å•†å“æŸ¥è¯¢å»¶è¿Ÿ |
| Order | 500+ | æ•°æ®åº“å†™å…¥ | åˆ†åº“åˆ†è¡¨ | è®¢å•åˆ›å»ºæˆåŠŸç‡ |
| Delivery | 200 | ä½ç½®è®¡ç®— | åœ°ç†ä½ç½®ç´¢å¼• | æŠ¢å•å“åº”æ—¶é—´ |
| Promotion | 150 | ä»·æ ¼è®¡ç®— | ç®—æ³•ä¼˜åŒ–+ç¼“å­˜ | è®¡ç®—å‡†ç¡®æ€§ |
| Wallet | 100 | èµ„é‡‘å®‰å…¨ | åˆ†å¸ƒå¼äº‹åŠ¡ | è´¦åŠ¡å¹³è¡¡æ£€æŸ¥ |
| Admin | 50 | å¤æ‚æŸ¥è¯¢ | æ•°æ®ä»“åº“ | æŠ¥è¡¨ç”Ÿæˆæ—¶é—´ |

## 7. éƒ¨ç½²æ¶æ„å»ºè®®

### MVPé˜¶æ®µï¼ˆå•æœºéƒ¨ç½²ï¼‰
```
[Nginx] â†’ [Gateway] â†’ [User|Merchant|Order|Delivery|Promotion|Wallet|Admin]
                           â†“
[MySQL Master] â† â†’ [Redis] â† â†’ [RabbitMQ]
```

### æ‰©å±•é˜¶æ®µï¼ˆåˆ†å¸ƒå¼éƒ¨ç½²ï¼‰
```
[è´Ÿè½½å‡è¡¡] â†’ [Gatewayé›†ç¾¤] â†’ [å¾®æœåŠ¡é›†ç¾¤]
                              â†“
[MySQLé›†ç¾¤] â† â†’ [Redisé›†ç¾¤] â† â†’ [RabbitMQé›†ç¾¤]
```

è¿™ä¸ªå¯è§†åŒ–æ–¹æ¡ˆæ¸…æ™°å±•ç¤ºäº†ï¼š
- âœ… **8ä¸ªæœåŠ¡çš„èŒè´£è¾¹ç•Œ**
- âœ… **æœåŠ¡é—´çš„è°ƒç”¨ä¾èµ–å…³ç³»**
- âœ… **æ ¸å¿ƒä¸šåŠ¡æµç¨‹çš„æœåŠ¡åä½œ**
- âœ… **æ•°æ®æµè½¬å’Œå¼‚æ­¥äº‹ä»¶**
- âœ… **éƒ¨ç½²å’Œæ‰©å±•å»ºè®®**

ç°åœ¨æ•´ä¸ªæ¶æ„æ–¹æ¡ˆæ—¢æœ‰æ¸…æ™°çš„æ–‡å­—è¯´æ˜ï¼Œåˆæœ‰ç›´è§‚çš„å›¾è¡¨å±•ç¤ºï¼Œéå¸¸é€‚åˆä¸ç”²æ–¹è¿›è¡ŒæŠ€æœ¯å¯¹æ¥ï¼